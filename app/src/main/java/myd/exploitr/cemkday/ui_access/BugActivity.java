package myd.exploitr.cemkday.ui_access;

import android.content.Intent;
import android.os.Build;
import android.os.Bundle;
import android.support.annotation.Nullable;
import android.support.design.widget.FloatingActionButton;
import android.support.design.widget.Snackbar;
import android.support.v7.app.AppCompatActivity;
import android.support.v7.widget.SwitchCompat;
import android.util.Base64;
import android.widget.CheckBox;
import android.widget.EditText;
import android.widget.Spinner;
import android.widget.Toast;

import myd.exploitr.cemkday.R;

public class BugActivity extends AppCompatActivity {
	
	private EditText bug_;
	private Spinner bug_type_;
	private SwitchCompat multi_seen, rooted;
	private FloatingActionButton submit_bug;
	private CheckBox privacy_agree;
	private boolean trigger = false, wentPause = false;
	
	protected String getMailText() {
		return "Don't edit even a single character!\n" +
				"x-x-x-x-x-x-x-x-x-x-x-x-x-x-x-x-x-x-x-x-x-x-x-x-x-x-x-x-x-x-x-x-x\n\n" +
				
				Base64.encodeToString(("Device : " + Build.DEVICE + "\n" +
						"SDK : " + Build.VERSION.SDK_INT + "\n" +
						"Model : " + Build.MODEL + "\n" +
						"Manufacturer : " + Build.MANUFACTURER + "\n" +
						"Rooted : " + rooted.isChecked() + "\n" +
						"Cyclical : " + multi_seen.isChecked() + "\n" +
						"BUG_MSG : " + bug_.getText().toString() + "\n" +
						"Severity : " + bug_type_.getSelectedItemPosition()).getBytes(), Base64.NO_PADDING)
				
				+ "\n\nx-x-x-x-x-x-x-x-x-x-x-x-x-x-x-x-x-x-x-x-x-x-x-x-x-x-x-x-x-x-x-x-x\n\n" +
				"You can add extra comments below ↓";
	}
	
	@Override
	protected void onCreate(Bundle savedInstanceState) {
		super.onCreate(savedInstanceState);
		setContentView(R.layout.activity_bug);
		
		if (getSupportActionBar() != null) {
			getSupportActionBar().setTitle("Submit Bugs/Features±");
		}
		
		bug_ = findViewById(R.id.bug_);
		bug_type_ = findViewById(R.id.bug_type_);
		multi_seen = findViewById(R.id.multi_seen);
		submit_bug = findViewById(R.id.submit_bug);
		rooted = findViewById(R.id.rooted);
		privacy_agree = findViewById(R.id.policy_agree);
		
		submit_bug.setOnClickListener(v -> {
					if (privacy_agree.isChecked()) {
						Snackbar.make(v, "Wait...", Snackbar.LENGTH_SHORT).show();
						startActivityForResult(Intent.createChooser(new Intent(Intent.ACTION_SEND)
										.setType("text/plain")
										.putExtra(Intent.EXTRA_EMAIL, new String[]{getString(R.string.dev_on_way)})
										.putExtra(Intent.EXTRA_TEXT, getMailText())
										.putExtra(Intent.EXTRA_SUBJECT, "BUG_REPORT_" + getPackageName()),
								"Choose Your Mail Client"), 1001);
						trigger = true;
					} else {
						Toast.makeText(this, "Please Accept Privacy Policy", Toast.LENGTH_SHORT).show();
					}
				}
		);
	}
	
	@Override
	protected void onPause() {
		if (trigger) {
			wentPause = true;
		}
		super.onPause();
	}
	
	@Override
	protected void onActivityResult(int requestCode, int resultCode, @Nullable Intent data) {
		if (wentPause) {
			finish();
		} else {
			trigger = false;
		}
		super.onActivityResult(requestCode, resultCode, data);
	}
}
